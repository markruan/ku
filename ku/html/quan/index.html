<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
		<meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
		<title>圈子</title>
		<link href="../../css/Hui.css" rel="stylesheet" type="text/css" />
		<link rel="stylesheet" type="text/css" href="http://at.alicdn.com/t/font_1466120150_564351.css">
		<style type="text/css">
			.iconfont {
				font-size: 39px;
			}
			.H-button {
				min-width: 0;
			}
		</style>
		<script type="text/html" id="tppl">
			<% for(var i=0; i < list.length; i++){ if(list[i].type==1){%>
			<div class="bbs-item H-border-vertical-bottom-after">
			<div class="H-flexbox-horizontal H-theme-background-color-white H-border-vertical-bottom-after">
			<div class="H-padding-vertical-both-8">
			<img data-echo="<%=imageCache(list[i].pic) %>" src="../../image/default.jpg" alt="" title="" class="animated fadeIn H-display-block H-margin-horizontal-left-10 H-border-radius-circle H-width-45 H-height-45">
			</div>
			<div class="H-flex-item H-margin-10">
			<div class="H-theme-font-color-999 H-font-size-14 H-flexbox-horizontal H-text-horizontal-left H-box-sizing-border-box">
			<span class="H-display-block H-flex-item H-text-align-left H-font-size-14"><span class="H-theme-font-color1"><%=list[i].nickname %></span></span>
			<span class="H-display-block H-flex-item H-text-align-right H-theme-font-color-999 H-font-size-12" id="times"><button class="H-button H-font-size-14 H-outline-none H-theme-background-color-transparent  H-padding-horizontal-both-10 H-theme-font-color1 H-theme-border-color1 H-theme-border-color1-click H-theme-background-color1-click H-theme-font-color1-click"><span class="H-badge H-display-inline-block">
			<!--<i class="H-iconfont H-icon-plus H-font-size-14 H-vertical-right"></i>-->
			</span>图片
			</button></span>
			</div>
			<div class="H-theme-font-color-999 H-text-show-row-1 H-margin-vertical-top-2 H-font-size-12">
			<%=list[i].signature %>
			</div>
			</div>
			</div>
			<div class="H-theme-background-color-white H-clear-both H-width-100-percent H-display-table H-box-sizing-border-box H-padding-horizontal-left-10" onclick=" openPhoto('<%=list[i].cover %>') ">
			<div class="H-display-table-cell H-float-left  H-box-sizing-border-box H-width-avg-1 H-padding-horizontal-right-10 H-margin-vertical-bottom-10">
			<img data-echo="<%=imageCache(list[i].cover) %>" src="../../image/default.jpg" class="H-width-100-percent  H-display-block" alt="" title="">
			</div>
			</div>
			<div class="H-theme-background-color-white H-theme-font-color-333 H-padding-10 H-font-size-14" onclick=" ">
			<%=list[i].text %>
			</div>
			<div class="H-flexbox-horizontal H-clear-both H-theme-background-color-white H-padding-8 H-box-sizing-border-box H-border-vertical-top-margin-both-10-after">
			<span onclick="openComm(<%=list[i].data_id %>,3)" class="H-font-size-14 H-flex-item  H-center-all H-theme-font-color9 H-border-horizontal-right-after"><i  class="H-iconfont H-icon-review-fill  H-font-size-18 H-margin-horizontal-right-5"></i><label class="H-display-inline-block H-vertical-middle">评论</label></span>
			<!--<span class="H-font-size-14 H-flex-item  H-center-all"><i onclick=" " class="H-iconfont H-icon-like H-theme-font-color-ccc H-font-size-18 H-margin-horizontal-right-5"></i><label class="H-display-inline-block H-theme-font-color-ccc H-vertical-middle">收藏</label></span>-->
			<span class="H-font-size-14 H-flex-item  H-center-all  H-border-horizontal-left-after"><i onclick="dianzan(<%=list[i].data_id %>,this)" class="H-iconfont H-icon-ding-null H-theme-font-color-ccc H-font-size-18 H-margin-horizontal-right-5"></i><label class="H-display-inline-block H-theme-font-color-ccc H-vertical-middle"><%=list[i].zan%></label></span>
			<span onclick="shareImg('<%=list[i].cover %>')" class="H-font-size-14 H-flex-item  H-center-all  H-border-horizontal-left-after"><i class="H-iconfont H-icon-share-to H-theme-font-color-ccc H-font-size-18 H-margin-horizontal-right-5"></i><label class="H-display-inline-block H-theme-font-color-ccc H-vertical-middle"> </label></span>
			</div>
			</div>
			<% }else{%>
			<div class="bbs-item H-border-vertical-bottom-after">
			<div class="H-flexbox-horizontal H-theme-background-color-white H-border-vertical-bottom-after">
			<div class="H-padding-vertical-both-8">
			<img data-echo="<%=imageCache(list[i].pic) %>" src="../../image/default.jpg" alt="" title="" class="animated fadeIn H-display-block H-margin-horizontal-left-10 H-border-radius-circle H-width-45 H-height-45">
			</div>
			<div class="H-flex-item H-margin-10">
			<div class="H-theme-font-color-999 H-font-size-14 H-flexbox-horizontal H-text-horizontal-left H-box-sizing-border-box">
			<span class="H-display-block H-flex-item H-text-align-left H-font-size-14"><span class="H-theme-font-color1"><%=list[i].nickname %></span></span>
			<span class="H-display-block H-flex-item H-text-align-right H-theme-font-color-999 H-font-size-12" id="times"><button class="H-button H-font-size-14 H-outline-none H-theme-background-color-transparent  H-padding-horizontal-both-10 H-theme-font-color1 H-theme-border-color1 H-theme-border-color1-click H-theme-background-color1-click H-theme-font-color1-click"><span class="H-badge H-display-inline-block">
			<!--			<i class="H-iconfont H-icon-plus H-font-size-14 H-vertical-right"></i>-->
			</span>音乐
			</button></span>
			</div>
			<div class="H-theme-font-color-999 H-text-show-row-1 H-margin-vertical-top-2 H-font-size-12">
			<%=list[i].signature %>
			</div>
			</div>
			</div>
			<div class="H-theme-background-color-white H-clear-both H-width-100-percent H-display-table H-box-sizing-border-box H-padding-horizontal-left-10" onclick="">
			<div class="H-display-table-cell H-float-left  H-box-sizing-border-box H-width-avg-1 H-padding-horizontal-right-10 H-margin-vertical-bottom-10">
			<span class="H-badge H-display-inline-block H-position-absolute H-z-index-10" style="right: 6%;bottom: 12px;margin-bottom: 3px;"> <i data-click="0"  onclick=" switchplay(this,'<%=list[i].mp3%>') " class=" pplay iconfont icon-bofang H-theme-font-color-white  H-font-size-28"></i></span>
			<img data-echo="<%=imageCache(list[i].cover) %>" src="../../image/default.jpg" class="H-width-100-percent  H-display-block" alt="" title="">
			</div>
			<!--<div class="H-display-table-cell H-float-left  H-box-sizing-border-box H-width-avg-3 H-padding-horizontal-right-10 H-margin-vertical-bottom-10">
			<img data-echo="<%=list[i].cover %>" src="../../image/default.jpg" class="H-width-100-percent H-display-block" alt="" title="">
			</div>
			<div class="H-display-table-cell H-float-left  H-box-sizing-border-box H-width-avg-3 H-padding-horizontal-right-10 H-margin-vertical-bottom-10">
			<img data-echo="<%=list[i].cover %>" src="../../image/default.jpg" class="H-width-100-percent  H-display-block" alt="" title="">
			</div>-->
			</div>
			<div class="H-theme-background-color-white H-theme-font-color-333 H-padding-10 H-font-size-14" onclick="">
			<%=list[i].title %>-<%=list[i].artist %>
			</div>
			<div class="H-theme-background-color-white H-theme-font-color-333 H-padding-10 H-font-size-14" onclick="">
			<%=list[i].text%>
			</div>
			<div class="H-flexbox-horizontal H-clear-both H-theme-background-color-white H-padding-8 H-box-sizing-border-box H-border-vertical-top-margin-both-10-after">
			<span onclick="openComm(<%=list[i].data_id %>,3)" class="H-font-size-14 H-flex-item  H-center-all H-theme-font-color9 H-border-horizontal-right-after"><i  class="H-iconfont H-icon-review-fill  H-font-size-18 H-margin-horizontal-right-5"></i><label class="H-display-inline-block H-vertical-middle">评论</label></span>
			<span tapmode onclick=" shouCang(<%=list[i].sid %>,'<%=list[i].user %>','<%=list[i].mp3 %>','<%=list[i].artist %>','<%=list[i].title %>','<%=list[i].cover %>')" class="H-font-size-14 H-flex-item  H-center-all"><i class="H-iconfont H-icon-like H-theme-font-color-ccc H-font-size-18 H-margin-horizontal-right-5"></i><label class="H-display-inline-block H-theme-font-color-ccc H-vertical-middle">收藏</label></span>
			<span class="H-font-size-14 H-flex-item  H-center-all  H-border-horizontal-left-after"><i onclick="dianzan(<%=list[i].data_id %>,this)" class="H-iconfont H-icon-ding-null H-theme-font-color-ccc H-font-size-18 H-margin-horizontal-right-5"></i><label class="H-display-inline-block H-theme-font-color-ccc H-vertical-middle"><%=list[i].zan%></label></span>
			<span onclick="share('<%=list[i].title %>','<%=list[i].artist %>','<%=list[i].cover %>','<%=list[i].mp3 %>')" class="H-font-size-14 H-flex-item  H-center-all  H-border-horizontal-left-after"><i class="H-iconfont H-icon-share-to H-theme-font-color-ccc H-font-size-18 H-margin-horizontal-right-5"></i><label class="H-display-inline-block H-theme-font-color-ccc H-vertical-middle"> </label></span>
			</div>
			</div>
			<% }}%>
		</script>
	</head>
	<body>
		<!--   <p class="H-padding-horizontal-both-10 H-font-size-16">下面数据是通过H.tppl模板引擎渲染的</p> -->
		<div class="result"></div>
		<script src="../../script/H.js" type="text/javascript"></script>
		<script src="../../script/play.js" type="text/javascript"></script>
		<script src="../../script/api.js" type="text/javascript"></script>
		<script type="text/javascript" src="../../script/echo.min.js"></script>
		<script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
		<script src="../../script/comm.js" type="text/javascript"></script>
		<script type="text/javascript">
			H.tppl_flag = ["<%", "%>"];
			var url = hostUrl + '/quan123.php';
			var page = 1;
			function initPage(page) {
				api.showProgress({
					title : ' 加载中...',
					text : '先喝杯茶...',
					modal : false
				})
				api.ajax({
					url : hostUrl + '/quan123.php',
					method : 'post',
					data : {
						values : {
							page : page
						},
					}
				}, function(ret, err) {
					if (ret) {
						var playlist = ret
						var data = {
							list : ret
						};
						var render = H.tppl(H.D("#tppl").innerHTML);
						if (page == 1) {
							H.D(".result").innerHTML = render(data);
						} else {
							$api.after($api.last(H.D(".result")), render(data))
						}
						//					H.D(".result").innerHTML = render(data);
						//						懒加载
						echo.init({
							offset : 0,
							throttle : 350,
							unload : false,
							callback : function(element, op) {
							}
						});
						api.hideProgress();
					} else {
						api.toast({
							msg : '没有更多了'
						});
						api.hideProgress();
					}
				});
			}

			apiready = function() {
				api.addEventListener({
					name : 'scrolltobottom',
					extra : {
						threshold : 180 //设置距离底部多少距离时触发，默认值为0，数字类型
					}
				}, function(ret, err) {
					page++
					initPage(page)
				});
				api.addEventListener({
					name : 'playingquan'
				}, function(ret, err) {
					if (ret) {
						play()
					}
				});
				initPage(page)
				api.setRefreshHeaderInfo({
					visible : true,
					bgColor : '#f2f2f2',
					textColor : '#4d4d4d',
					textDown : '下拉刷新...',
					textUp : '松开刷新...',
					showTime : true
				}, function(ret, err) {
					initPage(page);
					api.hideProgress();
					api.refreshHeaderLoadDone();
				});
				api.addEventListener({
					name : 'stopmusic'
				}, function(ret, err) {
					if (ret) {
						pause()
					}
				});
			}
			function openComm(id, type) {
				api.getPrefs({
					key : 'user' // 用户信息key
				}, function(ret, err) {
					var val = ret.value;
					if (val && val != "") {
						api.openWin({
							name : 'comm',
							url : '../../html/music/comm/head.html',
							opaque : true,
							vScrollBarEnabled : false,
							pageParam : {
								type : type,
								id : id
							}
						});
						//					$api.setStorage('typer1', 1);
					} else {
						alert("登陆后方可评论");
						api.openWin({
							name : 'reg_login_win',
							url : '../../html/entry/entry_head.html',
							pageParam : {}
						});
					}
				});
			}

			function dianzan(id, button, zan) {
				api.ajax({
					url : hostUrl + '/quanZ.php',
					method : 'post',
					timeout : 30,
					dataType : 'text',
					returnAll : false,
					data : {
						values : {
							id : id,
						},
					}
				}, function(ret, err) {
					if (ret == 1) {
						$api.attr(button, 'class', 'H-iconfont H-icon-ding-null H-theme-font-color-red H-font-size-18 H-margin-horizontal-right-5 animated bounceIn');
						var zan = button.nextSibling
						$api.text(zan, eval($api.text(zan)) + 1);
						$api.attr(zan, 'style', 'color: #ff003c');
					}
				});
			}

			function share(title, art, img, mp3) {
				var data = {}
				data.title = title;
				data.art = art;
				data.img = img;
				data.mp3 = mp3;
				api.openFrame({
					name : 'sing_share',
					url : '../../html/single_share_body.html',
					rect : {
						x : 0,
						y : 0,
						w : api.winWidth,
						h : api.winHeight
					},
					pageParam : {
						data : data
					},
				});
			}

			function share(title, art, img, mp3) {
				var data = {}
				data.title = title;
				data.art = art;
				data.img = img;
				data.mp3 = mp3;
				api.openFrame({
					name : 'sing_share',
					url : '../../html/single_share_body.html',
					rect : {
						x : 0,
						y : 0,
						w : api.winWidth,
						h : api.winHeight
					},
					pageParam : {
						data : data
					},
				});
			}

			function shareImg(url) {
				api.openFrame({
					name : 'sing_share',
					url : '../../html/single_share_body.html',
					rect : {
						x : 0,
						y : 0,
						w : api.winWidth,
						h : api.winHeight
					},
					pageParam : {
						img : url
					},
				});
			}

			function shouCang(sid, user, musicUrl, artists, songName, albumpic) {
				api.ajax({
					url : hostUrl + '/mylist.php',
					method : 'post',
					cache : false,
					timeout : 30,
					dataType : 'text',
					data : {
						values : {
							sid : sid,
							uid : $api.getStorage('userinfo').data_id
						}
					}
				}, function(ret, err) {
					if (ret == 1) {
						api.ajax({
							url : hostUrl + '/addm.php',
							method : 'post',
							cache : true,
							timeout : 30,
							dataType : 'json',
							data : {
								values : {
									mp3 : musicUrl,
									artist : artists,
									title : songName,
									poster : albumpic,
									user : user,
									uid : $api.getStorage('userinfo').data_id,
									background : albumpic,
									cover : albumpic,
									sid : sid
									//							usericon: userIcon
								}
							}
						}, function(ret, err) {
							//coding...
						});
						api.toast({
							msg : '收藏成功'
						});
					} else if (ret == 2) {
						api.confirm({
							title : '取消收藏',
							msg : '亲，要取消吗？',
							buttons : ['确定', '取消']
						}, function(ret, err) {
							if (ret.buttonIndex == 1) {
								quXiaoShouCang(sid)
							} else {
							}
						});
					} else {
						api.toast({
							msg : '收藏失败'
						});
					}
					//coding...
				});
				////////////////
			}

			function quXiaoShouCang(sid) {
				var uid = $api.getStorage('userinfo').data_id
				api.ajax({
					url : hostUrl + '/quxiao.php',
					method : 'post',
					cache : false,
					timeout : 30,
					dataType : 'text',
					data : {
						values : {
							uid : uid,
							sid : sid,
						}
					}
				}, function(ret, err) {
					if (ret == 1) {
						alert('成功')
					} else {
						alert('失败')
					}
				});
			}
		</script>
	</body>
</html>