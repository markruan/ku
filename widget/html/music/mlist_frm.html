<!doctype html>
<html>

<head>
	<meta charset="UTF-8">
	<meta name="copyright" content="www.apicloud.com" />
	<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
	<meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
	<title>歌单</title>
	<link rel="stylesheet" type="text/css" href="../../css/api.css" />
	<link rel="stylesheet" type="text/css" href="../../css/Hui.css" />
	<script type="text/javascript" src="../../script/vue.min.js"></script>

	<style>
		html,
		body {
			min-height: 100%;
			background-color: #f9f9f9;
		}

		.fr {
			float: right;
		}

		.fl {
			float: left;
		}

		.mt5 {
			margin-top: 5px;
		}

		.mt10 {
			margin-top: 10px;
		}

		.mt15 {
			margin-top: 15px;
		}

		.mt20 {
			margin-top: 20px;
		}

		.ml5 {
			margin-left: 0.5em;
		}

		.mr5 {
			margin-right: 0.5em;
		}

		.hdivider {
			width: 100%;
			height: 1px;
			background-color: #e0e0e0;
		}

		.br {
			border-right: 1px solid #e0e0e0;
		}

		.row {
			display: -webkit-box;
			display: -webkit-flex;
		}

		.col {
			-webkit-box-flex: 1;
			-webkit-flex: 1;
			flex: 1;
			margin: 0 5px;
			position: relative;
		}

		.swiper-container img {
			width: 100%;
		}
		/* 歌单标题 */

		.sectionTitle {
			height: 2em;
			line-height: 2em;
			font-size: 1.12em;
		}

		.sectionTitle .titleDivider {
			display: inline-block;
			height: 1.12em;
			width: 3px;
			vertical-align: top;
			background-color: #D43C33;
			margin-top: 0.44em;
			margin-left: 0.7em;
			margin-right: 0.3em;
		}
		/* 歌单 */

		.col .listcoverbar {
			position: absolute;
			top: 0;
			background-color: rgba(0, 0, 0, 0.4);
			width: 100%;
			height: 1.2em;
		}

		.col .listcoverbar span {
			color: #fff;
		}

		.col .listcoverbar .earphone {
			width: 1em;
			margin-top: 0.2em;
			margin-right: 0.3em;
		}

		.col .listcover {
			width: 100%;
		}

		.col .listtitle {
			height: 2.4em;
			font-size: 1em;
			line-height: 1.2em;
			overflow: hidden;
			text-overflow: ellipsis;
			display: -webkit-box;
			-webkit-line-clamp: 2;
			-webkit-box-orient: vertical;
		}
		/* item样式 */

		.egret-item {
			height: 4em;
		}

		.egret-item .egret-item-box-cover-center {
			display: table;
			height: inherit;
		}

		.egret-item .egret-item-box-cover-center .egret-item-box-abtc {
			display: table-cell;
			vertical-align: middle;
		}

		.egret-item .egret-item-box-cover-center .egret-item-box-abtc img {
			width: 3em;
			vertical-align: top;
		}
		/* 右侧箭头样式 */

		.egret-item .egret-item-arrow {
			display: table;
			height: inherit;
		}

		.egret-item .egret-item-arrow .egret-item-box-abtc {
			display: table-cell;
			vertical-align: middle;
		}

		.egret-item .egret-item-arrow .egret-item-box-abtc img {
			width: 0.8em;
			vertical-align: top;
		}
		/* 中间shelf  两个条目*/

		.egret-item .egret-item-shelf {
			height: inherit;
		}

		.egret-item .egret-item-shelf .egret-item-shelf-title {
			font-size: 1.1em;
			margin-top: 0.6em;
		}

		.egret-item .egret-item-shelf .egret-item-shelf-subtitle {
			font-size: 0.6em;
			color: #666;
			margin-top: 0.6em;
		}
		/* 中间shelf 一个条目 */

		.egret-item .egret-item-shelf-single {
			height: inherit;
			line-height: 4em;
			font-size: 1.1em;
		}

		.egret-item .egret-item-shelf-redclassify {
			color: #E03F40;
			border: 1px solid #E03F40;
			font-size: inherit;
			padding: 0.1em;
			border-radius: 1px;
			margin-right: 5px;
		}
		/* 用flex重写框架 */

		.egret-flex-item {
			display: -webkit-box;
			-webkit-box-align: center;
			height: 3em;
			/*background-color: #fff;*/
		}
		/* 左部logo */

		.egret-flex-item-logo {
			max-width: 50px;
			min-width: 50px;
			margin-left: 0.5em;
			margin-right: 0.2em;
			-webkit-box-flex: 1;
			-webkit-box-align: center;
		}

		.egret-flex-item-logo img {
			height: 2em;
			width: 2em;
			-webkit-box-align: center;
			vertical-align: top;
			/*否则图片不会居中，底部仍然是会有空白*/
		}
		/* 中间文本信息 */

		.egret-flex-item-shelf {
			overflow: hidden;
			-webkit-box-flex: 2;
			-webkit-box-align: center;
		}

		.egret-flex-item-shelf div {
			text-overflow: ellipsis;
			white-space: nowrap;
			overflow: hidden;
		}

		.egret-flex-item-shelf .egret-flex-item-shelf01 {
			font-size: 1.1em;
		}

		.egret-flex-item-shelf .egret-flex-item-shelf02 {
			font-size: 0.6em;
			color: #666;
			margin-top: 0.6em;
		}

		.egret-flex-item-shelf .egret-flex-item-redclassify {
			color: #E03F40;
			border: 1px solid #E03F40;
			font-size: inherit;
			padding: 0.1em;
			border-radius: 1px;
			margin-right: 5px;
		}
		/* 右部箭头 */

		.egret-flex-item-arrow {
			-webkit-box-flex: 1;
			max-width: 10px;
			min-width: 10px;
			margin-right: 15px;
		}

		.egret-flex-item-arrow img {
			width: 100%;
			max-width: 10px;
		}
		/* 暗头部 */

		.egret-dark-title {
			height: 1.4em;
			line-height: 1.4em;
			font-size: 0.8em;
			background-color: #e7e7e7;
			color: #666;
			padding-left: 10px;
		}
		/* special 对个别自定义 */

		.special {
			height: 4em;
		}

		.special .egret-flex-item-logo img {
			height: 3em;
			width: 3em;
		}
		/* */

		.inputmusic {
			text-align: center;
			margin-top: 30px;
		}

		.inputmusic p {
			color: #6F6F6F;
		}

		.inputmusic p .inputbtn {
			color: #3A9DD3;
			text-decoration: underline;
		}
		/* 独立条目 */

		.isolateitem-top {
			margin-top: 10px;
			border-top: 1px solid #e0e0e0;
		}

		.isolateitem-bottom {
			border-bottom: 1px solid #e0e0e0;
		}
		/* 退出 */

		.exitbtn {
			margin: 15px 10px;
			border-radius: 4px;
			border: 1px solid #D33A31;
			background-color: #fff;
			color: #D33A31;
			text-align: center;
			height: 2em;
			line-height: 2em;
		}
		/* 个人用户标题 */

		.musiclistprofile {
			height: 7em;
			background-color: #fff;
		}

		.musiclistprofile .egret-flex-item-logo img {
			height: 6em;
			width: 6em;
		}

		.musiclistprofile .egret-flex-item-logo {
			max-width: 6em;
			min-width: 6em;
			margin-left: 0.5em;
			margin-right: 0.2em;
			-webkit-box-flex: 1;
			-webkit-box-align: center;
		}

		.musiclistprofile .egret-flex-item-shelf {
			margin-left: 0.5em;
		}

		.musiclistprofile .egret-flex-item-shelf .egret-flex-item-shelf01 {
			font-size: 1.3em;
		}

		.musiclistprofile .egret-flex-item-shelf .egret-flex-item-shelf02 {
			margin-top: 1.6em;
			-webkit-box-align: center;
			display: -webkit-box;
		}

		.musiclistprofile .egret-flex-item-shelf .egret-flex-item-shelf02 .createrlogo {
			width: 2em;
		}

		.musiclistprofile .egret-flex-item-shelf .egret-flex-item-shelf02 .creatername {
			margin: 0 1em;
		}

		.userinfo {
			display: -webkit-box;
			background-color: #fff;
			/*padding: 10px 0;*/
		}

		.userinfo .userinfocol {
			/*-webkit-box-flex:1;*/
			padding: 10px 0;
			text-align: center;
			width: 25%;
			box-sizing: border-box;
		}

		.userinfo .userinfocol .info {
			font-size: 0.8em;
			color: #999;
		}

		.userinfo .userinfocol .info img {
			width: 2em;
		}

		.userinfo .userinfocol .num {
			padding-top: 5px;
		}
		/* 播放全部*/

		.playall {
			background-color: #f9f9f9;
		}

		.playall .egret-flex-item-arrow {
			-webkit-box-flex: 1;
			max-width: 2.0em;
			min-width: 2.0em;
			margin-right: 15px;
		}

		.playall .egret-flex-item-arrow img {
			max-width: none;
		}

		.playall .egret-flex-item-logo img {
			width: 1.5em;
			height: 1.5em;
		}
		/* egret item 抽象右部 */

		.egret-flex-item-abright {
			display: -webkit-box;
			-webkit-box-flex: 1;
			border-bottom: 1px solid #e0e0e0;
			-webkit-box-align: center;
			height: 4em;
		}
		/* musiclist 特殊样式 */

		.musiclist-item {
			height: 4em;
		}

		.musiclist-item .egret-flex-item-logo {
			text-align: center;
			font-size: 1.2em;
			color: #999999;
		}

		.musiclist-item .egret-flex-item-shelf .egret-flex-item-shelf01 {
			font-size: 1em;
		}

		.musiclist-item .egret-flex-item-arrow {
			max-width: 24px;
			min-width: 24px;
		}

		.musiclist-item .egret-flex-item-arrow img {
			max-width: none;
		}
		/* 弹出工具条 */

		.musiclist-item-tool {
			background-color: #303030;
			color: #fff;
			display: -webkit-box;
			padding: 0 10px;
			display: none;
		}

		.musiclist-item-tool .userinfocol {
			-webkit-box-flex: 1;
			text-align: center;
			padding: 5px 0;
		}

		.musiclist-item-tool .userinfocol .info img {
			width: 50%;
		}

		.musiclist-item-tool .userinfocol .num {
			color: #A8A8A8;
			font-size: 0.8em;
		}
		/* 悬浮 */

		.exitbtnhover {
			background-color: #d33a31;
			color: #fff;
		}

		.userinfo .toolhover {
			background-color: #e2e2e2;
		}

		.musiclist-item-tool .toolhover {
			background-color: #1d1d1d;
		}

		.allplayhover {
			background-color: #e2e2e2;
		}

		.loading {
			position: absolute;
			top: 0;
			left: 50%;
			background: #fff;
			width: 2.5rem;
			height: 2.5rem;
			margin-top: 70%;
			margin-left: -1.25rem;
			background: url('../../image/loading.gif') no-repeat;
			background-size: cover;
			-webkit-animation: rotating 5s linear infinite;
			animation: rotating 5s linear infinite;
		}

		.loading-txt {
			position: absolute;
			top: 0;
			color: #4a4a4a;
			margin-top: 87%;
			width: 100%;
			text-align: center;
		}
		.active{
			color: red;
		}
	</style>
</head>

<body>
	<!-- 1 用户登录 -->
	<div id="app" v-cloak>
		<div v-show="!isloading">
			<div id='ava' class="egret-flex-item musiclistprofile">
				<div class="egret-flex-item-logo">
					<img :src="coverImgUrl" alt="" class="">
				</div>
				<div class="egret-flex-item-shelf">
					<div class="egret-flex-item-shelf01" style="font-size: 1em">
						{{listdata.name}}
					</div>
					<span class="egret-flex-item-shelf02"> <img :src="avatarUrl" alt="" class="createrlogo">
							 <div class="creatername">
								 {{nickname}}
							 </div>
							 <div class="egret-flex-item-arrow">
								 <img src="./image/musiclist/cm2_list_icn_arr.png"  alt="" class="">
							 </div> </span>
				</div>
			</div>
			<div class="userinfo">
				<div class="userinfocol01 userinfocol br" tapmode="toolhover" @click="collectmusic" data-click="0">
					<div class="info"><img :src="iscollectmusic?collectmusicIcon1:collectmusicIcon" alt="" class="collectmusic">
					</div>
					<div class="num" id="shoucangcount">

						{{listdata.subscribedCount}}
					</div>
				</div>
				<div class="userinfocol02 userinfocol br" tapmode="toolhover" @click="openCom">
					<div class="info"><img src="./image/musiclist/musiclistcommet.png" alt="">
					</div>
					<div class="num" id="CommCount">
						{{listdata.commentCount}}
					</div>
				</div>
				<div class="userinfocol03 userinfocol br" tapmode="toolhover" @click="openMusiclistshare">
					<div class="info"><img src="./image/musiclist/musiclistshare.png" alt="">
					</div>
					<div class="num">
						{{listdata.shareCount}}
					</div>
				</div>
				<div class="userinfocol03 userinfocol" tapmode="toolhover" @click="downloadAll">
					<div class="info"><img src="./image/musiclist/musiclistdown.png" alt="">
					</div>
					<div class="num">
						下载
					</div>
				</div>
			</div>
			<div class="egret-flex-item isolateitem-bottom playall" tapmode="allplayhover" onclick="">
				<div class="egret-flex-item-logo">
					<img src="./image/musiclist/musiclistplay.png" alt="" class="">
				</div>
				<div class="egret-flex-item-shelf">
					<div class="egret-flex-item-shelf01">
						专辑<span id="Num" class="totalnum">共{{songlistcount}}首音乐</span>
					</div>
				</div>
				<div class="egret-flex-item-arrow">
					<img src="./image/musiclist/musiclistplayarrow.png" alt="" class="">
				</div>
			</div>
			<!-- 列表部分 -->
			<div class="egret-flex-item musiclist-item H-touch-active" v-for="(item,index) in songdatalist"  @click="openMusci(item.id,index,item.name) "  :class="{active: activeName == item.name}">
				<div class="egret-flex-item-logo">
					{{index+1}}
				</div>
				<div class="egret-flex-item-abright" >
					<div tapmode class="egret-flex-item-shelf  " >
						<div class="egret-flex-item-shelf01">{{item.name}}</div>
						<div class="egret-flex-item-shelf02">{{item.ar['0'].name}}</div>
					</div>
					<div class="egret-flex-item-arrow">
						<!-- <img src="./image/musiclist/musiclistmore.png" alt="" class="toobarimg" onclick="expandlist(0, this)"> -->
					</div>
				</div>
			</div>
		</div>

	</div>
</body>
<script type="text/javascript " src="../../script/api.js "></script>
<script type="text/javascript " src="../../script/mm.js "></script>
<script type="text/javascript " src="../../script/music.js "></script>
<script type="text/javascript" src="../../script/jquery/jquery.min.js"></script>
<!-- <script type="text/javascript " src="../../script/jquery/jquery.min.js "></script> -->



<script type="text/javascript ">
	var lid
	var getinfo = new getinfo()
	var isopen = $api.getStorage('isopen');
	apiready = function() {
		lid = api.pageParam.lid
		app.inti()
		api.setFrameAttr({
			name: api.frameName,
			bounces: true
		});
	}

	var app = new Vue({
		el: "#app ",

		data: {
			coverImgUrl: '../../image/default.jpg',
			min_coverImgUrl: '',
			avatarUrl: '',
			listdata: '',
			nickname: '',
			songdatalist: '',
			songlistcount: '',
			isloading: true,
			iscollectmusic: false,
			collectmusicIcon: './image/musiclist/musiclisttool01.png',
			collectmusicIcon1: "./image/musiclist/musiclistcollect.png",
			activeName:''
		},
		created() {

		},
		mounted: function() {

		},
		methods: {
			inti: function() {
				uiloading()
				api.readFile({
					path: api.fsDir + '/cache/' + lid + '.json',
				}, function(ret, err) {
					// console.log(JSON.stringify(ret));
					if (ret.status) {
						app.isloading = false
						var cachedata = $api.strToJson(ret.data)
							// console.log(JSON.stringify(cachedata));
						app.coverImgUrl = imageCache(cachedata.coverImgUrl + '?param=140y140')
						app.avatarUrl = imageCache(cachedata.creator.avatarUrl + '?param=40y40')
						app.listdata = cachedata;
						app.songdatalist = cachedata.tracks
						app.songlistcount = cachedata.tracks.length
						stoploading()

					} else {
						app.getlistdata()

					}
				});

			},
			getlistdata: function() {
				// var url='http://music.163.com/api/playlist/detail?updateTime=-1&id=' + lid,
				var likelistids = $api.getStorage('likelistids')


				var url = musicApi + '/playlist/detail?id=' + lid
				api.ajax({
					url: url,
					cache: true,
				}, function(ret, err) {
					if (ret.code = 200) {
						// 判断歌单是否被收藏
						var res = $.inArray(lid, likelistids);
						if (res != -1) {
							app.iscollectmusic = true
						} else {
							app.iscollectmusic = false
						}

						app.isloading = false
						app.coverImgUrl = imageCache(ret.playlist.coverImgUrl + '?param=140y140')
						app.avatarUrl = imageCache(ret.playlist.creator.avatarUrl + '?param=40y40')
						app.min_coverImgUrl = imageCache(ret.playlist.coverImgUrl + '?param=40y40')
						app.nickname = ret.playlist.creator.nickname
						app.songlistcount = ret.playlist.tracks.length
						app.listdata = ret.playlist
						app.songdatalist = ret.playlist.tracks
						stoploading()
						api.writeFile({
							path: api.fsDir + '/cache/' + lid + '.json',
							data: ret.playlist
						}, function(ret, err) {});
					} else {
						api.toast({
							msg: ret.msg,
							duration: 2000,
							location: 'bottom'
						});

					}

				});
			}, //
			openMusci: function(lid, index,name) {
				this.activeName = name
				api.sendEvent({
					name: 'songid',
					extra: {
						id: lid,
						index: index,
						songlist:app.songdatalist
					}
				});

				// var mlistdata = $api.setStorage('listm')
				$api.setStorage('listm', app.songdatalist);
				//
				// $api.setStorage('name', 1);
				// $api.setStorage('idi', index);
				// $api.setStorage('listopen', 1);
				// if (!isopen) {
				// 	api.openWin({
				// 		name: 'nww',
				// 		url: '../../html/music/bo_head.html',
				// 		// delay: 300,
				// 		slidBackEnabled: false,
				// 		animation: {
				// 			type: "push", //动画类型（详见动画类型常量）
				// 			subType: "from_bottom", //动画子类型（详见动画子类型常量）
				// 			duration: 400 //动画过渡时间，默认300毫秒
				// 		},
				// 		pageParam: {
				// 			sid: lid,
				// 			index: index,
				// 			mlistdata: mlistdata
				// 		}
				// 	});
				// 	setTimeout(
				// 		api.sendEvent({
				// 			name: 'songid',
				// 			extra: {
				// 				sid: lid,
				// 				index: index,
				// 				mlistdata: mlistdata
				// 			}
				// 		}), 1000)
				// } else {
				// 	api.openWin({
				// 		name: 'nww',
				// 	});
				// 	api.sendEvent({
				// 		name: 'songid',
				// 		extra: {
				// 			sid: lid,
				// 			index: index,
				// 			mlistdata: mlistdata
				// 		}
				// 	})
				// }
			},
			openMusiclistshare: function() {
				var wx = api.require('wx');

				//分享页面
				wx.shareWebpage({
					apiKey: '',
					scene: 'timeline',
					title: app.listdata.name,
					description: '聆听音乐 感悟人生',
					thumb: app.min_coverImgUrl + '.jpg',
					contentUrl: 'http://sfun.me/#/playListDetail/' + api.pageParam.lid
				}, function(ret, err) {
					if (ret.status) {
						api.toast({
							msg: '分享成功'
						});
					} else {
						api.toast({
							msg: '取消分享'
						});
					}


				});

			}, //结束
			openCom: function() {
				if (!$api.getStorage('userinfo')) {
					api.toast({
						msg: '请先登陆'
					});
					return
				}

				api.openWin({
					name: 'comm',
					url: '../../html/music/comm/head.html',
					opaque: true,
					vScrollBarEnabled: false,
					pageParam: {
						type: 2,
						sid: lid
					}
				});
			},
			downloadAll: function() {
				api.toast({
					msg: '因版权问题暂无法提供下载'
				});

			},
			collectmusic: function() {


				if (app.iscollectmusic) {
					// 点开

					app.collectmusicIcon = "./image/musiclist/musiclisttool01.png";
					// 取消收藏

				} else {
					// 关闭


					getinfo.getDengLuInfo('/playlist/subscribe?t=1&id=' + app.listdata.id, function(data) {

						if (data.code == 200) {
							app.collectmusicIcon = "./image/musiclist/musiclistcollect.png";
							api.toast({
								msg: '成功',
								duration: 1000,
								location: 'bottom'
							});
						} else if (data.code == 501) {
							app.collectmusicIcon = "./image/musiclist/musiclistcollect.png";
							api.actionSheet({
								title: '已经收藏，要取消吗？',
								cancelTitle: '先留着',
								destructiveTitle: '确定',
								buttons: []
							}, function(ret, err) {
								if (ret.buttonIndex == 1) {
									getinfo.getDengLuInfo('/playlist/subscribe?t=2&id=' + app.listdata.id, function(data) {
										if (data.code == 200) {
											api.toast({
												msg: '取消成功',
												duration: 2000,
												location: 'bottom'
											});

										}
									})

								} else {
									// alert( JSON.stringify( err ) );
								}
							});
						} else {
							api.toast({
								msg: '收藏失败',
								duration: 1000,
								location: 'bottom'
							});
						}
					})

				}
			}

		}
	})
</script>

</html>
