<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
		<title>title</title>
		<link rel="stylesheet" type="text/css" href="../css/Hui.css" />
		<script type="text/javascript" src="../script/vue.min.js"></script>
		<style>
			.display1 {
				display: none
			}
		</style>
	</head>
	<body>
		<div id="app">
			<div v-bind:style="{display:xianshi}">
				<div v-html="html2"></div>
			</div>
			<ul v-if='articles.length>0'  >
				<div v-for='item in articles'>
					<div class="H-text-list H-flexbox-horizontal  H-theme-background-color-white H-border-vertical-bottom-after H-vertical-middle H-touch-active" @click="openww(item.id, item.album.picUrl, item.audio, item.name, item.artists[0].name) ">
						<div class="H-flex-item H-padding-horizontal-both-10 H-font-size-16 H-padding-vertical-both-12">
							{{item.name}}-{{item.artists[0].name}}
						</div>
						<span class="H-icon H-padding-horizontal-right-5 H-display-block"><i class="H-iconfont H-icon-arrow-right H-theme-font-color-ccc H-font-size-14 H-vertical-middle"></i></span>
					</div>
				</div>
			</ul>
		</div>
	</body>
	<script type="text/javascript" src="../script/api.js"></script>
	<script type="text/javascript">
		var data
		//		var obj = $api.byId('list');
		apiready = function() {
			api.addEventListener({
				name : 'smsg'
			}, function(ret, err) {
				app.say(ret.value.msg);
			});
			app.search_histry()
		}
		var app = new Vue({
			el : '#app',
			data : {
				message : '',
				articles : '',
				html2 : '',
				xianshi : 'block',
			},
			mounted : function() {
			},
			methods : {
				openww : function(sid, img, mp3, song, artists) {
					api.openWin({
						name : 'addmusic',
						url : '../html/kong/music/index.html',
						pageParam : {
							name : img,
							mp3 : mp3,
							song : song,
							artists : artists,
							sid : sid
						}
					});
				},
				say : function(message) {
					this.xianshi = 'none';
					api.showProgress({});
					app.articles = []
					api.ajax({
						url : sUrl + message + sEnd,
					}, function(ret, err) {
						console.log(JSON.stringify(ret))
						if (ret.code == 200 && ret.result) {
							//							$api.addCls(obj, 'H-display-none');
							var data = ret.result.songs
							app.articles = data
							api.hideProgress();
						} else {
							api.toast({
								msg : '数据错误'
							});
							api.hideProgress();
						}
					});
				},
				search_histry : function() {
				  uiloading()
					var list = $api.getStorage('h_list')
					//					大于10条删除最后一条
					if (list.length > 9) {
						list.splice(0, 1);
						$api.setStorage('h_list', list);
					}
					if ($api.getStorage('h_list').length > 0) {
						//						$api.removeCls(obj, 'H-display-none');
						for (var i = 0; i < list.length; i++) {
							this.html2 += '<div class="H-text-list H-flexbox-horizontal  H-theme-background-color-white H-border-vertical-bottom-after H-vertical-middle "   >';
							this.html2 += '<div onclick="app.inputkey(' + i + ')"  class="H-flex-item H-padding-horizontal-both-10 H-font-size-16 H-padding-vertical-both-12"><span   class="H-touch-active ">' + list[i] + '</span></div><span onclick="app.clean_h(' + i + ')"class="H-icon H-padding-horizontal-both-20   H-display-block "><i class="H-iconfont H-icon-close  H-theme-font-color-ccc H-font-size-14 H-vertical-middle"></i></span></div>';
						}
					} else {
						this.html2 = '<div class="H-center-all H-padding-vertical-top-20">暂无记录</div>';
					}
					stoploading()
					//					$api.html(obj, this.html2);
				},
				inputkey : function(index) {
					var list = $api.getStorage('h_list');
					api.sendEvent({
						name : 'smsg',
						extra : {
							msg : list[index]
						}
					});
				},
				clean_h : function(index) {
					var list = $api.getStorage('h_list');
					list.splice(index, 1)
					$api.setStorage('h_list', list);
					this.html2 = ''
					app.search_histry();
				}
			}
		})
	</script>
</html>
