<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
	<title>title</title>
	<link rel="stylesheet" type="text/css" href="../css/Hui.css" />
	<script type="text/javascript" src="../script/vue.min.js"></script>
	<style>
		.display1 {
			display: none
		}
	</style>
</head>

<body>
	<div id="app" v-cloak class="H-padding-vertical-top-5">
		<div v-bind:style="{display:xianshi}">
			<div v-html="html2"></div>
		</div>
		<ul v-if='articles.length>0'>
			<!-- <div v-for='item in articles'>
				<div class="H-text-list H-flexbox-horizontal  H-theme-background-color-white H-border-vertical-bottom-after H-vertical-middle ">
					<div class="H-flex-item H-padding-horizontal-both-10 H-font-size-16 H-padding-vertical-both-12 H-touch-active"  @click="openartist(item.id,item.name)">{{item.name}}</div>
					<!-- <div class=" H-radio-null H-display-block H-vertical-align-middle H-font-size-18 H-theme-font-color4  H-margin-horizontal-right-20 H-touch-active" @click="openwv(item.id) "><i class="H-iconfont H-icon-share H-theme-font-color-ccc H-font-size-14 H-vertical-middle"></i></div> -->
				<!-- </div> -->

				<div v-for='item in articles' class="H-flexbox-horizontal H-theme-background-color-white H-border-vertical-bottom-after"  @click="openartist(item.id,item.name,item.picUrl+'?param=440y250')">
						<div class="H-padding-vertical-both-10"><img  v-bind:src=item.img1v1Url+'?param=100y100' alt="" title="" class="H-display-block H-margin-horizontal-left-10  animated fadeIn" style="width: 40px; height: 40px;"></div>
						<div class="H-flex-item H-padding-20">
								<strong class="H-font-weight-normal font-weight-500 H-font-size-16 H-display-block">{{item.name}}</strong>
								<!-- <div class="H-font-size-14 H-theme-font-color-999 H-text-show-row-2 H-margin-vertical-top-5">
										<%=list[i].ar[0].name %>
								</div> -->
						</div>
						</div>
		</ul>
		</div>
</body>
<script type="text/javascript" src="../script/api.js"></script>
<script type="text/javascript">
	var data, list
		//		var obj = $api.byId('list');
	apiready = function() {
		api.addEventListener({
			name: 'smsg'
		}, function(ret, err) {

			app.say(ret.value.msg);
		});
		app.search_histry()
	}
	var app = new Vue({
		el: '#app',
		data: {
			message: '',
			articles: '',
       html2: '',
			xianshi: 'block',
		},
		mounted: function() {},
		methods: {
			openartist: function(artistId,artistName,img) {
				api.openWin({
					name: 'artistlist_h',
					url: '../html/artist/artist_head.html',
					pageParam: {
						artistId: artistId,
						artistName:artistName,
						artistImg:img,
						from:'search'
					},
					animation: {
						type: "movein", //动画类型（详见动画类型常量）
						subType: "from_bottom", //动画子类型（详见动画子类型常量）
						duration: 400
					}
				});
			},
			say: function(message) {
				this.xianshi = 'none';
				// api.showProgress({});
				// uiloading();
				app.articles = []
				api.ajax({
					url: musicApi + '/search?keywords=' + message + "&type=100",
					  cache: true,
				}, function(ret, err) {

					if (ret.code == 200 && ret.result) {
						//							$api.addCls(obj, 'H-display-none');
						var data = ret.result.artists
						app.articles = data
						// console.log(JSON.stringify(app.articles));
						stoploading()
					} else {

						api.toast({
							msg: '数据错误,稍后再试'
						});
						// api.hideProgress();
						stoploading()
					}
				});
			},
			search_histry: function() {
				uiloading()
				list = $api.getStorage('h_list')


				if ($api.getStorage('h_list') && $api.getStorage('h_list').length > 0) {
					//						$api.removeCls(obj, 'H-display-none');
					//					大于10条删除最后一条
					if (list.length > 9) {
						list.splice(0, 1);
						$api.setStorage('h_list', list);
					}
					for (var i = 0; i < list.length; i++) {
						this.html2 += '<div class="H-text-list H-flexbox-horizontal  H-theme-background-color-white H-border-vertical-bottom-after H-vertical-middle "   >';
						this.html2 += '<div onclick="app.inputkey(' + i + ')"  class="H-flex-item H-padding-horizontal-both-10 H-font-size-16 H-padding-vertical-both-12"><span   class="H-touch-active ">' + list[i] + '</span></div><span onclick="app.clean_h(' + i +
							')"class="H-icon H-padding-horizontal-both-20   H-display-block "><i class="H-iconfont H-icon-close  H-theme-font-color-ccc H-font-size-14 H-vertical-middle"></i></span></div>';
					}
				} else {
					this.html2 = '<div class="H-center-all H-padding-vertical-top-20">暂无记录</div>';
				}
				stoploading()
					//					$api.html(obj, this.html2);
			},
			inputkey: function(index) {
				var list = $api.getStorage('h_list');

				api.sendEvent({
					name: 'smsg',
					extra: {
						msg: list[index]
					}
				});
			},
			clean_h: function(index) {
				var list = $api.getStorage('h_list');
				list.splice(index, 1)
				$api.setStorage('h_list', list);
				this.html2 = ''
				app.search_histry();
			},
			ting: function(sid, mp3, cover, title, artist) {
				if (!$api.getStorage('isopen') || $api.getStorage('isopen') != 1) {
					$api.setStorage('listopen', 3);
					api.openWin({
						name: 'nww',
						url: '../html/music/bo_head.html',
						slidBackEnabled: false,
						animation: {
							type: "movein", //动画类型（详见动画类型常量）
							subType: "from_bottom", //动画子类型（详见动画子类型常量）
							duration: 500 //动画过渡时间，默认300毫秒
						},
						pageParam: {
							sid: sid,
							mp3: mp3,
							index: 0,
							mlistdata: false,
							cover: cover,
							title: title,
							artist: artist
						}
					});
				} else {
					api.sendEvent({
						name: 'songid',
						extra: {
							sid: sid,
							index: 0,
							mlistdata: false
						}
					})
					api.closeWin();

				}

			}
		}
	})
</script>

</html>
