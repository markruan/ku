<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
		<title>title</title>
		<!--<link rel="stylesheet" type="text/css" href="../../css/aui.css"/>-->
		<link rel="stylesheet" type="text/css" href="../css/Hui.css"/>
	</head>
	<body>
		<!--<div class="H-padding-vertical-bottom-10"></div>-->
		<div id='searchBar' class="H-padding-10 H-theme-background-color-white" onclick="" >
			<div class="H-search H-flexbox-horizontal H-box-sizing-border-box H-overflow-hidden H-position-relative">
				<div class="H-position-absolute H-z-index-100 H-width-100-percent H-height-100-percent H-vertical-middle H-text-align-center H-theme-font-color-999 H-border-radius-15" id="ser">
					<span class="H-display-block H-width-100-percent H-font-size-14"><i class="H-iconfont H-icon-search H-font-size-14"></i> 搜索关键字</span>
				</div>
				<input type="text" id="ipt" class="H-border-none  H-theme-background-color-f4f4f4 H-flex-item H-font-size-16 H-padding-horizontal-both-10 H-padding-vertical-both-5 H-border-radius-15" oninput="OnInput (event)" onpropertychange="OnPropChanged (event)"
				value=""  />
				<span class="H-display-block H-font-size-14 H-vertical-middle H-theme-font-color1 H-padding-horizontal-both-10 btn" style="display:none;">取消</span>
			</div>
		</div>
		<div id="list">
			<!--<ul class="aui-list-view" ></ul>-->
		</div>
	</body>
	<script type="text/javascript" src="../script/api.js"></script>
	<script src="../script/H.js" type="text/javascript"></script>
	<script type="text/javascript">
		var songs
		H.D("#ser").addEventListener("touchend", function(e) {
			this.style.cssText = "display:none;";
			H.D(".btn").removeAttribute("style");
			H.D("#ipt").setAttribute("placeholder", "请输入关键字");
		});
		H.D(".btn").addEventListener("touchend", function(e) {
			this.style.cssText = "display:none;";
			H.D("#ipt").setAttribute("placeholder", "");
			H.D("#ser").removeAttribute("style");
			$api.val($api.byId('ipt'), '');
		});
		function OnInput(event) {
			//          alert ( + event.target.value);
			s = event.target.value;
			search(s)
		}

		function search(s) {
			var html = '';
			var url = sUrl + s + sEnd
			api.ajax({
				url : url,
				dataType : 'json'
			}, function(ret, err) {
			console.log(JSON.stringify(ret))
				if (ret.result) {
					var arr = ret.result.songs;
					//					var myobj = eval(arr);
					//					var len = myobj.length;
					//					var obj = $api.byId('list');
					for (var i = 0; i < arr.length; i++) {
						arr[i].imgPath = arr[i].album.picUrl;
						arr[i].title = arr[i].name;
						arr[i].subTitle = arr[i].artists[0].name;
						//						var len = myobj.length;
						//						var bb = arr[i].name;
						//						var position = myobj[i].no;
						//						var artists = myobj[i].artists[0].name
						//						var mp3Url = myobj[i].audio
						//						var sid = arr[i].id
						//						var picc = myobj[i].album.picUrl
						//						var pic = JSON.stringify(picc)
						//						//				  html += '<div class="H-text-list H-flexbox-horizontal  H-theme-background-color-white H-border-vertical-bottom-after H-vertical-middle H-touch-active"  onclick="open(\''+ picc+'\')"  >';
						//						html += '<div class="H-text-list H-flexbox-horizontal  H-theme-background-color-white H-border-vertical-bottom-after H-vertical-middle H-touch-active"  onclick="openww(' + sid + ',\'' + picc + '\',\'' + mp3Url + '\',\'' + bb + '\',\'' + artists + '\')"  >';
						//						html += '<div class="H-flex-item H-padding-horizontal-both-10 H-font-size-16 H-padding-vertical-both-12">' + bb + '--' + artists + '</div></div>';
						//						$api.setStorage('ii', i);
					}
					//					$api.html(obj, html);
					var UIListView = api.require('UIListView');
					var searchBar = $api.offset($api.byId('searchBar'))
					UIListView.open({
						rect : {
							x : 0,
							y : searchBar.h,
							w : api.winWidth,
//							 h :api.winHeight-searchBar.h
						},
						data : arr,
						rightBtns : [{
							bgColor : '#388e8e',
							activeBgColor : '',
							width : 70,
							title : '按钮',
							titleSize : 12,
							titleColor : '#fff',
							icon : '',
							iconWidth : 20
						}],
						rightBtns : [{
							bgColor : '#388e8e',
							activeBgColor : '',
							width : 70,
							title : '按钮',
							titleSize : 12,
							titleColor : '#fff',
							icon : '',
							iconWidth : 20
						}],
						styles : {
							borderColor : 'rgba(153, 153, 153, 0.47)',
							item : {
								bgColor : 'rgba(0,0,0,0.0)',
								activeBgColor : '#F5F5F5',
								height : 55.0,
								imgWidth : 40,
								imgHeight : 40,
								imgCorner : 0,
								placeholderImg : '',
								titleSize : 12.0,
								titleColor : '#999',
								subTitleSize : 12.0,
								subTitleColor : '#999',
								remarkColor : '#999',
								remarkSize : 16,
								remarkIconWidth : 30
							}
						},
						fixedOn : api.frameName
					}, function(ret, err) {
						if (ret) {
							console.log(JSON.stringify(ret))
							if (ret.eventType == 'clickContent') {
								var index = ret.index
								var data = arr[index]
								openww(data.id, data.imgPath, data.audio, data.title, data.subTitle)
								//							alert(JSON.stringify(ret));
							} else {
								//								alert(JSON.stringify(err));
							}
							//					alert(JSON.stringify(ret));
						} else {
							//							alert(JSON.stringify(err));
						}
					});
					api.refreshHeaderLoadDone();
				} else {
				}
			});
		}

		apiready = function() {
		};
		function openww(sid, img, mp3, song, artists) {
			api.openWin({
				name : 'addmusic',
				url : '../html/kong/music/index.html',
				pageParam : {
					name : img,
					mp3 : mp3,
					song : song,
					artists : artists,
					sid : sid
				}
			});
		}
	</script>
</html>