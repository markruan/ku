<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
		<title>title</title>
		<link href="../../css/Hui.css" rel="stylesheet" type="text/css" />
		<style>
			.fresh {
				height: 35px;
				width: 100%;
				background-image: url('../../image/loading_more.gif');
				background-position: center center;
				background-repeat: no-repeat;
				background-size: 15px 15px;
			}
		</style>
	</head>
	<body class="H-display-none" id="body">
		<div class="H-padding-vertical-bottom-10"></div>
		<div id="main" class="H-padding-horizontal-right-10"></div>
	</body>
	<script type="text/javascript" src="../../script/api.js"></script>
	<script type="text/javascript" src="../../script/echo.min.js"></script>
	<script type="text/javascript" src="../../script/H.js"></script>
	<script type="text/javascript">
		function openMusicList(id) {
			api.openWin({
				name : 'musiclist',
				url : '../../html/music/mlist_win.html',
				delay : 200,
				reload : true,
				pageParam : {
					name : id
				}
			});
			api.removePrefs({
				key : 'play'
			});
		}

		function findinfo() {
			var pageSize = 10;
			api.showProgress({
				title : ' 加载中...',
				text : '先喝杯茶...',
				modal : false
			})
			api.ajax({
				url : hostUrl + '/ku.php',
				method : 'post',
				timeout : 30,
				dataType : 'json',
				returnAll : false,
				data : {
					values : {
						page : pageSize
					},
					//files: {file: 'fs://a.gif'}
				}
			}, function(ret, err) {
				if (ret) {
					for ( i = 0; i < ret.length; i++) {
						var Idd = ret[i].idd;
						var html = '';
						$api.setStorage('lenpage', ret.length);
						api.ajax({
							url : musicUrl + Idd + houZhui,
							cache : true,
							dataType : 'json',
						}, function(ret, err) {
							var tracksName = ret.result.name;
							var tracksId = ret.result.id;
							var avatarUrl = ret.result.creator.avatarUrl;
							var coverImgUrl = ret.result.coverImgUrl;
							var nickname = ret.result.creator.nickname;
							var description = ret.result.description
							var arr = ret.result.tracks;
							api.imageCache({
								url : coverImgUrl
							}, function(ret, err) {
								imgurl = ret.url;
								//							var myobj = eval(arr);
								html += '<div class="H-display-table-cell H-float-left  H-box-sizing-border-box H-width-avg-2 H-padding-horizontal-right-10 H-margin-vertical-bottom-10" onclick="openMusicList(' + tracksId + ')">';
								html += '<img  src="../../image/default.jpg"   data-echo="' + imgurl + '" class=" animated fadeIn H-width-100-percent H-display-block H-padding-horizontal-left-10" alt="" title=""   >';
								html += '<div class="H-text-align-center H-font-size-12 H-padding-vertical-top-5">' + tracksName + '</div></div>';
							});
							var obj = $api.byId('main');
							$api.html(obj, html);
							//							$api.setStorage('list', html);
							api.hideProgress();
							api.refreshHeaderLoadDone();
							echo.init({
								offset : 0,
								throttle : 150,
								unload : false,
								callback : function(element, op) {
								}
							});
						});
						//
					}
					
				} else {
					//					api.alert({
					//						msg : ('错误码：' + err.code + '；错误信息：' + err.msg + '网络状态码：' + err.statusCode)
					//					});
				};
			});
			$api.removeCls($api.byId('body'), 'H-display-none');
		}

		apiready = function() {
			findinfo()
			api.setRefreshHeaderInfo({
				visible : true,
				bgColor : '#f2f2f2',
				textColor : '#4d4d4d',
				textDown : '下拉刷新...',
				textUp : '松开刷新...',
				showTime : true
			}, function(ret, err) {
				findinfo()
				api.hideProgress();
				api.refreshHeaderLoadDone();
			});
		};
	</script>
</html>