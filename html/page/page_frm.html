<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
		<title>title</title>
		<link href="../../css/Hui.css" rel="stylesheet" type="text/css" />
		<style>
			.fresh {
				height: 35px;
				width: 100%;
				background-image: url('../../image/loading_more.gif');
				background-position: center center;
				background-repeat: no-repeat;
				background-size: 15px 15px;
			}
		</style>
	</head>
	<body  id="body">
		<div class="H-padding-vertical-bottom-10"></div>
		<div id="main" class="H-padding-horizontal-right-10"></div>
	</body>
	<script type="text/javascript" src="../../script/api.js"></script>
	<script type="text/javascript" src="../../script/echo.min.js"></script>
	<script type="text/javascript" src="../../script/H.js"></script>
	<script type="text/javascript">
		var page = 0;
		function openMusicList(id) {
			api.openWin({
				name : 'nww',
				url : '../../html/music/bo_head.html',
				delay : 500
			});
			api.openWin({
				name : 'musiclist',
				url : '../../html/music/mlist_win.html',
				delay : 200,
				reload : true,
				pageParam : {
					name : id
				}
			});
			api.removePrefs({
				key : 'play'
			});
		}

		function findinfo(page) {
			api.showProgress({
				title : ' 加载中...',
				text : '先喝杯茶...',
				modal : false
			})
			api.ajax({
				url : hostUrl + '/fen.php',
				method : 'post',
				data : {
					values : {
						page : page * 10
					},
				}
			}, function(ret, err) {
				if (ret) {
					var html = '';
					for ( i = 0; i < ret.length; i++) {
						var Idd = ret[i].idd;
						var coverImgUrl = imageCache(ret[i].imgUrl)
						var tracksName = ret[i].name
						$api.setStorage('lenpage', ret.length);
						html += '<div class="list H-display-table-cell H-float-left  H-box-sizing-border-box H-width-avg-2 H-padding-horizontal-right-10 H-margin-vertical-bottom-10" onclick="openMusicList(' + Idd + ')">';
						html += '<img  src="../../image/default.jpg"   data-echo="' + coverImgUrl + '" class=" animated fadeIn H-width-100-percent H-display-block H-padding-horizontal-left-10" alt="" title=""   >';
						html += '<div class="H-text-align-center H-font-size-12 H-padding-vertical-top-5">' + tracksName + '</div></div>';
						api.hideProgress();
						api.refreshHeaderLoadDone();
					}
					var obj = $api.byId('main');
					if (page == 0) {
						$api.html(obj, html);
					} else {
						$api.after($api.last(obj), html);
					}
					echo.init({
						offset : 0,
						throttle : 150,
						unload : false,
						callback : function(element, op) {
						}
					});
					$api.removeCls($api.byId('body'), 'H-display-none');
				} else {
					api.toast({
						msg : '没有更多了'
					});
					api.hideProgress();
					api.refreshHeaderLoadDone();
					//					api.alert({
					//						msg : ('错误码：' + err.code + '；错误信息：' + err.msg + '网络状态码：' + err.statusCode)
					//					});
				};
			});
		}

		apiready = function() {
			findinfo(page)
			api.setRefreshHeaderInfo({
				visible : true,
				bgColor : '#f2f2f2',
				textColor : '#4d4d4d',
				textDown : '下拉刷新...',
				textUp : '松开刷新...',
				showTime : true
			}, function(ret, err) {
				findinfo(page)
				api.hideProgress();
				api.refreshHeaderLoadDone();
			});
			api.addEventListener({
				name : 'scrolltobottom',
				extra : {
					threshold : 150 //设置距离底部多少距离时触发，默认值为0，数字类型
				}
			}, function(ret, err) {
				page++
				findinfo(page)
			});
		};
	</script>
</html>