<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
		<meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
		<title>Hui</title>
		<link href="../../css/Hui.css" rel="stylesheet" type="text/css" />
		<link rel="stylesheet" type="text/css" href="http://at.alicdn.com/t/font_1466120150_564351.css">
		<style type="text/css">
			.iconfont {
				font-size: 39px;
			}
		</style>
		<script type="text/html" id="tppl">
			<% for(var i=0; i < list.length; i++){ %>
			<div>
			<div class="H-padding-vertical-bottom-5"></div>
			<div class="H-theme-background-color-white H-clear-both H-width-100-percent H-display-table H-box-sizing-border-box  " onclick="">
			<div class="H-display-table-cell H-float-left  H-box-sizing-border-box H-width-avg-1   H-margin-vertical-bottom-10">
			<span class="H-badge H-display-inline-block H-position-absolute H-z-index-10" style="right: 6%;bottom: 12px;margin-bottom: 3px;"> <i data-click="0"  onclick=" switchplay(this,'<%=list[i].mp3%>') " class=" pplay iconfont icon-bofang H-theme-font-color-white  H-font-size-28"></i></span>
			<img  data-echo="<%=list[i].cover %>" src="../../image/default.jpg" class="H-width-100-percent  H-display-block" alt="" title="">
			</div>
			<div class="H-padding-vertical-bottom-10"></div>
			</div>
			<div class="H-theme-background-color-white H-theme-font-color-333 H-padding-10 H-font-size-14" onclick="">
			<%=list[i].title %>-<%=list[i].artist %>
			</div>
			<div class="H-flexbox-horizontal H-clear-both H-theme-background-color-white H-padding-8 H-box-sizing-border-box H-border-vertical-top-margin-both-10-after">
			<span class="H-font-size-14 H-flex-item  H-center-all H-theme-font-color9 H-border-horizontal-right-after"><i class="H-iconfont H-icon-review-fill  H-font-size-18 H-margin-horizontal-right-5"></i><label class="H-display-inline-block H-vertical-middle">3</label></span>
			<span class="H-font-size-14 H-flex-item  H-center-all"><i class="H-iconfont H-icon-like H-theme-font-color-ccc H-font-size-18 H-margin-horizontal-right-5"></i><label class="H-display-inline-block H-theme-font-color-ccc H-vertical-middle">3</label></span>
			<span class="H-font-size-14 H-flex-item  H-center-all  H-border-horizontal-left-after"><i class="H-iconfont H-icon-ding-null H-theme-font-color-ccc H-font-size-18 H-margin-horizontal-right-5"></i><label class="H-display-inline-block H-theme-font-color-ccc H-vertical-middle">3</label></span>
			<span class="H-font-size-14 H-flex-item  H-center-all  H-border-horizontal-left-after"><i class="H-iconfont H-icon-share-to H-theme-font-color-ccc H-font-size-18 H-margin-horizontal-right-5"></i><label class="H-display-inline-block H-theme-font-color-ccc H-vertical-middle"> </label></span>
			</div>
			</div>
			<% } %>
		</script>
	</head>
	<body>
		<!--   <p class="H-padding-horizontal-both-10 H-font-size-16">下面数据是通过H.tppl模板引擎渲染的</p> -->
		<div class="result"></div>
		<script src="../../script/H.js" type="text/javascript"></script>
		<script src="../../script/play.js" type="text/javascript"></script>
		<script src="../../script/api.js" type="text/javascript"></script>
		<script type="text/javascript" src="../../script/echo.min.js"></script>
		<script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
		<script type="text/javascript">
			H.tppl_flag = ["<%", "%>"];
			var url = "http://v7idc.com/m/i.php";
			$(function() {
				$.ajax({
					type : "post",
					url : url,
					dataType : "json",
					//data : params,
					success : function(msg) {
						var playlist = msg
						var data = {
							list : msg
						};
						var render = H.tppl(H.D("#tppl").innerHTML);
						H.D(".result").innerHTML = render(data);
						//						懒加载
						echo.init({
							offset : 0,
							throttle : 350,
							unload : false,
							callback : function(element, op) {
							}
						});
					}
				});
			});
			function switchplay(button, mp3) {
				var click = button.getAttribute("data-click");
				if (click == 0) {
					// 点开
					var dd = document.getElementsByClassName('icon-zanting');
					for ( i = 0; i < dd.length; i++) {
						$api.attr(dd[i], 'class', 'iconfont  icon-bofang H-theme-font-color-white');
					}
					button.setAttribute("data-click", 1);
					pauseAll()
					//					stop();
					play(mp3)
					H.toastLoading()
					$api.attr(button, 'class', 'iconfont  icon-zanting H-theme-font-color-white');
					//					api.toast({
					//						msg : '暂停播放'
					//					});
				} else {
					// 关闭
					button.setAttribute("data-click", 0);
					//					stop();
					pause(this);
					H.closeToast();
					$api.attr(button, 'class', 'iconfont  icon-bofang H-theme-font-color-white');
					//					api.toast({
					//						msg : '继续播放'
					//					});
				}
				//			}
			}

			function play(mp3) {
				var iii = $api.byId('playI');
				var netAudio = api.require('audio');
				netAudio.play({
					path : mp3
				}, function(ret, err) {
					H.closeToast();
					var duration = ret.duration;
					var tii = duration * 10;
					var current = ret.current;
					var percent = (current / duration) * 100;
					var per = Math.round(percent);
					var complete = ret.complete;
					var slider = api.require('slider');
					var dur = formatSeconds(duration);
					var cur = formatSeconds(current);
					//					api.getPrefs({
					//						key : 'isPlaying'
					//					}, function(ret, err) {
					//						if (ret.value == 1) {
					//							///锁屏播放
					//							audioCover(duration, songName, artists, per)
					//						}
					//					});
				});
			}

			function pause() {
				var netAudio = api.require('audio');
				netAudio.pause();
			}

			function pauseAll() {
				var mPause = 'pause()'
				api.execScript({
					name : 'nw',
					frameName : 'nn',
					script : mPause
				});
			}
		</script>
	</body>
</html>